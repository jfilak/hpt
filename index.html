<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Happy Python Testing</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/moon.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>Happy Python Testing</h1>
					<h3>Jakub Filak</h3>
					<a href='mailto:jakub@thefilaks.net?subject=HPT'>e-mail</a><br/>
					<a href='https://github.com/jfilak/hpt/'>examples</a>
				</section>
				<section>
					<h2>Automated testing is the key to success</h2>
					<p><small>Let machines to do the boring work</small></p>
				</section>
				<section>
					<h2>Everybody can code in Python</h2>
					<p>
						<small>Programmers can test</small>
					</p>
				</section>
				<section>
					<h2>Test drive development</h2>
					<p>
						<ol>
							<li>skeleton</li>
							<li>tests</li>
							<li>refactoring</li>
							<li>done</li>
						</ol>
					</p>
				</section>
				<section>
					<h2>Test pyramid</h2>
					<br/>
					<div>
						<p><small>Manual tests</small></p>
						<p>Integration tests</p>
						<p style="font-size:300%;"><big>Unit tests</big></p>
					</div>
				</section>
				<section>
					<h2>We need all kind of tests</h2>
					<a href="https://www.google.com/search?q=unit+tests+no+integration+tests">LGTFY</a>
				</section>
				<section>
					<p><small>Focus: unit tests</small><p>
				</section>
				<section>
					<h2>Terminology</h2>
					<ul>
						<li>Test Runner</li>
						<li>Fixtures</li>
						<li>Test Case</li>
						<li>Test Suite</li>
					<ul>
				</section>
				<section>
					<h1>Doctest</h1>
					<p><small><a href='https://docs.python.org/3/library/doctest.html'>documentation</a></small></p>
					<br/>
					<p>Simple, genius, but limited usage.<p>
				</section>
				<section>
					<h2>Documentation contains interactive python commands</h2>
					<pre><code class="hljs log">
$ python
Python 3.7.5 (default, Oct 17 2019, 12:09:47)
[GCC 9.2.1 20190827 (Red Hat 9.2.1-1)] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import math
>>> math.factorial(5)
120
					</code></pre>
				</section>
				<section>
					<a href='https://github.com/jfilak/hpt/tree/doctest'>doctest demo code</a>
				</section>
				<section>
					<h2>Doctest run possibilities</h2>
					<pre><code class='hljs bash'>
python3 datools/combinatorics.py

python3 -m doctest datools/__init__.py

python3 -m doctest USAGE.md

python3 -m doctest -v ...
					</code></pre></dd>
				</section>
				<section>
					<pre><code>Trying:
    binomial_coefficient(4, 2)
Expecting:
    6
ok
Trying:
    binomial_coefficient(4, -1)
Expecting:
    Traceback (most recent call last):
        ...
    ValueError: k must not be negative
ok
Trying:
    binomial_coefficient(2, 4)
Expecting:
    Traceback (most recent call last):
        ...
    ValueError: n must not be lower than k
ok
1 items had no tests:
    __main__
1 items passed all tests:
   3 tests in __main__.binomial_coefficient
3 tests in 2 items.
3 passed and 0 failed.
Test passed</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/doctest/datools/combinatorics.py#L7'>code</a>
				</section>
				<section>
					<pre><code>**********************************************************************
File "datools/__init__.py", line 11, in __init__
Failed example:
    get_seed()
Expected:
    17
Got:
    331999
**********************************************************************
1 items had failures:
   1 of   3 in __init__
***Test Failed*** 1 failures.</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/doctest/datools/__init__.py#L1'>code</a>
				</section>
				<section>
					<ul>
						<li><a href='https://github.com/jfilak/hpt/blob/doctest/datools/all.py'>test suite</a></li>
						<li><a href='https://github.com/jfilak/hpt/blob/doctest/datools/combinatorics.py#L12'>exceptions</a></li>
						<li><a href='https://github.com/jfilak/hpt/blob/doctest/datools/diff.py#L2'>multi-line</a></li>
						<li><a href='https://github.com/jfilak/hpt/blob/doctest/datools/diff.py#L2'>directive - diff</a></li>
						<li><a href='https://github.com/jfilak/hpt/blob/doctest/datools/range.py#L3'>directive - white space</a></li>
					</ul>
				</section>
				<section>
					<pre><code>**********************************************************************
File "datools/diff.py", line 2, in diff
Failed example:
    if True:
        print('1')
        print('2')
        print('3')
Expected:
    1
    3
    4
Got:
    1
    2
    3
**********************************************************************
1 items had failures:
   1 of   1 in diff
***Test Failed*** 1 failures.</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/doctest/datools/diff.py#L2'>code</a>
				</section>
				<section>
					<pre><code>**********************************************************************
File "datools/diff.py", line 2, in diff
Failed example:
    if True: #doctest: +REPORT_UDIFF
        print('1')
        print('2')
        print('3')
Differences (unified diff with -expected +actual):
    @@ -1,3 +1,3 @@
     1
    +2
     3
    -4
**********************************************************************
1 items had failures:
   1 of   1 in diff
***Test Failed*** 1 failures.</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/doctest/datools/diff.py#L2'>code</a>
				</section>
				<section>
					<h2>Debugging failing tests</h2>
					<pre><code class='hljs python'>import pdb; pdb.set_trace()</code></pre>
					<pre><code class='hljs shell'>python3 -c "import datools, doctest; doctest.debug(datools, 'datools')"</code></pre>
				</section>
				<section>
					<h2>Advanced test runners</h2>
					<dl>
						<dt>unittest</dt>
						<dd><pre>create an instance of DocTestSuite in load_tests</pre></dd>
						<dt>pytest</dt>
						<dd><pre><code class='hljs shell'>pytest --doctest-modules</code></pre></dd>
						<dt>nose</dt>
						<dd><pre><code class='hljs shell'>notetest --with-doctest</code></pre></dd>
					</dl>
				</section>
				<section>
					<h1>unittest</h1>
					<ul>
						<li>distributed with Python</li>
						<li>inspired by jUnit/CppUnit</li>
						<li>modules + classes + methods</li>
					</ul>
					<br/>
					<a href='https://docs.python.org/3/library/unittest.html'>documentation</a>
				</section>
				<section>
					<a href='https://github.com/jfilak/hpt/tree/unittest'>unittest demo code</a>
				</section>
				<section>
					<h2>Assert</h2>
					<pre><code class='hljs python'>self.assertEqual(2, 3, msg='must fail')</code></pre>
					<pre><code class='hljs python'>self.assertRaises(ValueError)</code></pre>
					<pre><code class='hljs python'>self.assertRaisesRegex(ValueError, '.*')</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/unittest/datools/test_combinatorics.py'>code</a>
				</section>
				<section>
					<h2>Own Assert</h2>
					<pre><code class='hljs python'>self.addTypeEqualityFunc(type, callable)</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/unittest/tests/unit/test_types.py'>code</a>
				</section>
				<section>
					<pre><code>======================================================================
FAIL: test_n_choose_k_constructor_assignments_false (tests.unit.test_types.TestTypesNChooseK)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/I335255/repos/upstream/hpt/tests/unit/test_types.py", line 50, in test_n_choose_k_constructor_assignments_false
    self.assertEqual(lhs, rhs)
AssertionError: <datools.types.NChooseK object at 0x7fc0321f5f50> != <datools.types.NChooseK object at 0x7fc0321f5f90>
</pre></code>
				</section>
				<section>
					<pre><code>======================================================================
FAIL: test_n_choose_k_constructor_assignments_false (tests.unit.test_types.TestTypesNChooseK)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/I335255/repos/upstream/hpt/tests/unit/test_types.py", line 50, in test_n_choose_k_constructor_assignments_false
    self.assertEqual(lhs, rhs)
AssertionError: NChooseK(4, 2) != NChooseK(4, 1)
  Expected K: 2
  Got      K: 1
</pre></code>
				</section>
				<section>
					<h2>Fixtures</h2>
					<pre><code class='hljs python'>def setUpModule():
	pass

def tearDownModule():
	pass

class Test(unittest.TestCase):

	@classmethod
	def setUpClass(cls):
		pass

	@classmethod
	def teardownClass(cls):
		pass

	def setUp(self):
		pass

	def tearDown(self):
		pass</code></pre>
				</section>
				<section>
					<h2>Run tests</h2>
					<pre><code class='hljs shell'>
# find test*.py
$ python -m unittest discover

$ python -m unittest tests.unit.test_types.TestTypesNChooseK.test_n_choose_k_constructor_assignments_false

$ python -m unittest discover -f

$ python -m unittest discover -k cloud
					</code></pre>
				</section>
				<section>
					<h2>Debugging failing tests</h2>
					<pre><code class='hljs python'>import tests.unit.test_types 

tests.unit.test_types.TestTypesNChooseK('test_n_choose_k_constructor_assignments_false').debug() 

import pdb; pdb.pm()</code></pre>
				</section>
				<section>
					<h1>pytest</h1>
					<ul>
						<li>extra package</li>
						<li>avoid boilerplates</li>
						<li>versatile fixtures</li>
					</ul>
					<br/>
					<a href='https://docs.pytest.org/en/latest/'>documentation</a>
				</section>
				<section>
					<h2>Pytest in action</h2>
					<a href='https://github.com/jfilak/hpt/tree/pytest'>demo code</h2>
				</section>
				<section>
					<h2>Assert</h2>
					<pre><code class='hljs python'>assert 1 == 2</code></pre>
					<pre><code class='hljs python'>pytest.raises(ValueError, match=None)</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/pytest/datools/combinatorics_test.py'>demo code</h2>
				</section>
				<section>
					<h2>Own Assert</h2>
					<pre><code class='hljs python'>def pytest_assertrepr_compare(op, left, right):</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/pytest/conftest.py'>code</a>
				</section>
				<section>
					<h2>Capture output</h2>
					<pre><code class='hljs python'>def test_method(capsys):</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/pytest/tests/unit/test_datools.py#L35'>code</a>
				</section>
				<section>
					<h2>Temporary directory</h2>
					<pre><code class='hljs python'>def test_method(tmpdir):</code></pre>
				</section>
				<section>
					<h2>Fixtures</h2>
					<pre><code class='hljs python'>@pytest.fixture
def data():
	pass

def test_do(data):
	pass
	</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/pytest/tests/unit/test_datools.py#L10'>demo</a>
				</section>
				<section>
					<h2>Run tests</h2>
					<pre><code>
$ touch conftest.py
$ pytest
$ pytest -k ...
$ pytest -s ...

# @pytest.mark.cloud
$ pytest -m cloud
$ pytest -x --pdb
$ pytest --lf
					</code></pre>
				</section>
				<section>
					<h1>nose</h1>
					<p>Compatible test runner with pytest and unittest and also implements some ideas from unittest and some from pytest and some own ideas.</p>
					<br/>
					<a href='https://nose.readthedocs.io/en/latest/'>documentation</a>
				</section>
				<section>
					<h1>unittest.mock</h1>
					<a href='https://docs.python.org/3/library/unittest.mock.html'>documentation</a><br/>
					<br/>
					<a href='https://github.com/jfilak/hpt/blob/mock/datools/train.py'>demo module</a><br/>
					<a href='https://github.com/jfilak/hpt/blob/mock/tests/unit/test_train.py'>demo test</a>
				</section>
				<section>
					<h1>Coverage.py</h1>
					<a href='https://coverage.readthedocs.io/en/v4.5.x/'>documentation</a><br/>
				</section>
				<section>
					<h2>Doctest begin</h2>
					<pre><code class='hljs shell'>coverage run --source=datools datools/combinatorics.py
coverage report
Name                       Stmts   Miss  Cover
----------------------------------------------
datools/__init__.py            5      5     0%
datools/all.py                 2      2     0%
datools/combinatorics.py      10      0   100%
datools/diff.py                0      0   100%
datools/pdb_test.py            0      0   100%
datools/range.py               0      0   100%
----------------------------------------------
TOTAL                         17      7    59%
					</code></pre>
					<a href='https://github.com/jfilak/hpt/tree/doctest/datools'>code</a>
				</section>
				<section>
					<h2>Doctest continue</h2>
					<pre><code class='hljs shell'>coverage run -a --source=datools -m doctest datools/__init__.py
coverage report
Name                       Stmts   Miss  Cover
----------------------------------------------
datools/__init__.py            5      0   100%
datools/all.py                 2      2     0%
datools/combinatorics.py      10      0   100%
datools/diff.py                0      0   100%
datools/pdb_test.py            0      0   100%
datools/range.py               0      0   100%
----------------------------------------------
TOTAL                         17      2    88%
					</code></pre>
					<a href='https://github.com/jfilak/hpt/tree/doctest/datools'>code</a>
				</section>
				<section>
					<h2>Get statements</h2>
					<pre><code class='hljs shell'>coverage report -m --skip-covered
Name             Stmts   Miss  Cover   Missing
----------------------------------------------
datools/all.py       2      2     0%   3-6
----------------------------------------------
TOTAL               17      2    88%

5 files skipped due to complete coverage.
					</code></pre>
					<a href='https://github.com/jfilak/hpt/blob/doctest/datools/all.py'>code</a>
				</section>
				<section>
					<h2>Pytest & nose</h2>
					<pre><code class='hljs shell'>pytest --cov=datools
nose --with-coverage --cover-package=datools</code></pre>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
